<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dubaaai | logic</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root { --pink: #e6bbc7; --glow: rgba(230, 187, 199, 0.4); --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.1); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: #050505; color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .header { padding: 20px; text-align: center; z-index: 10; }
        .nav { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .nav-btn { background: var(--glass); border: 1px solid var(--border); color: #666; padding: 8px 20px; border-radius: 100px; cursor: pointer; transition: 0.3s; font-size: 12px; }
        .nav-btn.active { color: var(--pink); border-color: var(--pink); box-shadow: 0 0 15px var(--glow); }

        #calc-view, #ask-view { flex: 1; display: none; padding: 20px; overflow-y: auto; max-width: 1000px; margin: 0 auto; width: 100%; }
        .active-view { display: flex !important; flex-direction: column; gap: 20px; }

        .calc-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; height: 100%; }
        .calc-main { background: var(--glass); border: 1px solid var(--border); border-radius: 24px; padding: 20px; display: flex; flex-direction: column; }
        #display { font-size: 24px; text-align: right; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 12px; margin-bottom: 20px; color: var(--pink); min-height: 80px; }
        .keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .key { background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.2s; font-size: 14px; }
        .key:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .key:active { transform: scale(0.95); box-shadow: 0 0 10px var(--pink); }
        .fn-key { color: var(--pink); font-weight: bold; }

        .graph-area { background: var(--glass); border: 1px solid var(--border); border-radius: 24px; padding: 20px; }
        canvas { width: 100% !important; height: 300px !important; }

        #chat-history { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 15px 20px; border-radius: 20px; max-width: 85%; border: 1px solid var(--border); }
        .user { align-self: flex-end; background: rgba(230,187,199,0.1); color: var(--pink); }
        .ai { align-self: flex-start; background: var(--glass); }
        .input-box { background: var(--glass); border: 1px solid var(--border); border-radius: 100px; padding: 15px 25px; color: white; outline: none; width: 100%; margin-top: 10px; }

        @keyframes pulse { 50% { opacity: 0.4; } }
        .thinking { animation: pulse 1s infinite; color: var(--pink); }
    </style>
</head>
<body>

    <div class="header">
        <div style="letter-spacing: 5px; font-size: 12px; color: var(--pink)">DUBAAAI LOGIC</div>
        <div class="nav">
            <button class="nav-btn active" onclick="switchView('calc', this)">CALCULATE</button>
            <button class="nav-btn" onclick="switchView('ask', this)">ASK</button>
        </div>
    </div>

    <div id="calc-view" class="active-view">
        <div class="calc-grid">
            <div class="calc-main">
                <div id="display">0</div>
                <div class="keypad">
                    <button class="key fn-key" onclick="press('AC')">AC</button>
                    <button class="key fn-key" onclick="press('graph')">PLOT</button>
                    <button class="key fn-key" onclick="press('sin(')">sin</button>
                    <button class="key fn-key" onclick="press('/')">/</button>
                    <button class="key" onclick="press('7')">7</button>
                    <button class="key" onclick="press('8')">8</button>
                    <button class="key" onclick="press('9')">9</button>
                    <button class="key fn-key" onclick="press('*')">*</button>
                    <button class="key" onclick="press('4')">4</button>
                    <button class="key" onclick="press('5')">5</button>
                    <button class="key" onclick="press('6')">6</button>
                    <button class="key fn-key" onclick="press('-')">-</button>
                    <button class="key" onclick="press('1')">1</button>
                    <button class="key" onclick="press('2')">2</button>
                    <button class="key" onclick="press('3')">3</button>
                    <button class="key fn-key" onclick="press('+')">+</button>
                    <button class="key" onclick="press('0')">0</button>
                    <button class="key" onclick="press('.')">.</button>
                    <button class="key" onclick="press('x')">x</button>
                    <button class="key fn-key" style="background: var(--pink); color: black;" onclick="press('=')">=</button>
                </div>
            </div>
            <div class="graph-area">
                <div style="font-size: 10px; margin-bottom: 10px; color: #666;">GRAPHING SYSTEM v1.0</div>
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>

    <div id="ask-view">
        <div id="chat-history"></div>
        <input type="text" id="ai-input" class="input-box" placeholder="Ask anything..." onkeypress="if(event.key==='Enter')askAI()">
    </div>

    <script>
        let currentExpr = "";
        let chart = null;

        function switchView(view, btn) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('calc-view').classList.toggle('active-view', view === 'calc');
            document.getElementById('ask-view').classList.toggle('active-view', view === 'ask');
        }

        function press(key) {
            const display = document.getElementById('display');
            if (key === 'AC') { currentExpr = ""; display.innerText = "0"; }
            else if (key === '=') {
                try {
                    currentExpr = math.evaluate(currentExpr).toString();
                    display.innerText = currentExpr;
                } catch { display.innerText = "Error"; }
            }
            else if (key === 'graph') { plotGraph(); }
            else {
                currentExpr += key;
                display.innerText = currentExpr;
            }
        }

        function plotGraph() {
            const ctx = document.getElementById('myChart').getContext('2d');
            const xValues = math.range(-10, 10, 0.5).toArray();
            const yValues = xValues.map(x => {
                try { return math.evaluate(currentExpr, {x: x}); } 
                catch { return 0; }
            });

            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: xValues,
                    datasets: [{
                        label: 'f(x) = ' + currentExpr,
                        data: yValues,
                        borderColor: '#e6bbc7',
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)' } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' } }
                    }
                }
            });
        }

        async function askAI() {
            const input = document.getElementById('ai-input');
            const history = document.getElementById('chat-history');
            const val = input.value.trim();
            if(!val) return;

            const userDiv = document.createElement('div');
            userDiv.className = "msg user";
            userDiv.innerText = val;
            history.appendChild(userDiv);
            input.value = "";

            const aiDiv = document.createElement('div');
            aiDiv.className = "msg ai thinking";
            aiDiv.innerText = "processing logic...";
            history.appendChild(aiDiv);

            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ text: val })
                });
                const data = await res.json();
                aiDiv.classList.remove('thinking');
                aiDiv.innerHTML = marked.parse(data.content);
            } catch { aiDiv.innerText = "stall."; }
            history.scrollTop = history.scrollHeight;
        }

        window.onload = () => {
            currentExpr = "sin(x)";
            plotGraph();
        };
    </script>
</body>
</html>