<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dubaaai</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --pink: #e6bbc7;
            --black: #050505;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: var(--black); color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Header & Nav */
        .header { padding: 25px; text-align: center; }
        .brand { font-size: 12px; letter-spacing: 6px; text-transform: uppercase; color: var(--pink); margin-bottom: 15px; }
        .nav { display: flex; justify-content: center; gap: 8px; }
        .v-btn { background: var(--glass); border: 1px solid var(--border); color: #666; padding: 6px 15px; border-radius: 20px; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .v-btn.active { color: var(--pink); border-color: var(--pink); background: rgba(230,187,199,0.05); }

        /* Chat area */
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 18px; max-width: 800px; margin: 0 auto; width: 100%; scrollbar-width: none; }
        .msg { max-width: 85%; padding: 15px 20px; border-radius: 22px; line-height: 1.5; font-size: 14px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
        .user { align-self: flex-end; background: rgba(230,187,199,0.1); color: var(--pink); }
        .ai { align-self: flex-start; background: var(--glass); }
        
        /* Image Embeds */
        .msg img { width: 100%; border-radius: 15px; margin-top: 10px; border: 1px solid var(--border); }

        /* Input area */
        .footer { padding: 30px 20px; max-width: 800px; margin: 0 auto; width: 100%; }
        .in-box { background: var(--glass); border: 1px solid var(--border); border-radius: 100px; padding: 5px 20px; display: flex; align-items: center; }
        input { flex: 1; background: transparent; border: none; color: white; padding: 12px 0; outline: none; font-size: 14px; }
        
        .thinking .brand { animation: pulse 1s infinite; }
        @keyframes pulse { 50% { opacity: 0.3; } }
    </style>
</head>
<body id="main">
    <div class="header">
        <div class="brand">dubaaai</div>
        <div class="nav">
            <button class="v-btn active" onclick="setMode('Fast', this)">Fast</button>
            <button class="v-btn" onclick="setMode('Image', this)">Image</button>
        </div>
    </div>

    <div id="chat"></div>

    <div class="footer">
        <div class="in-box">
            <input type="text" id="input" placeholder="type sum..." autocomplete="off">
        </div>
    </div>

    <script>
        let mode = "Fast", history = [];
        const input = document.getElementById('input');

        function setMode(m, btn) {
            mode = m;
            document.querySelectorAll('.v-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function add(content, type) {
            const chat = document.getElementById('chat'), div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerHTML = type === 'ai' ? marked.parse(content) : content.toLowerCase();
            chat.appendChild(div);
            chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
        }

        async function send() {
            const val = input.value.trim();
            if (!val) return;
            add(val, 'user'); input.value = '';

            if (mode === "Image") {
                const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(val)}?width=1024&height=1024&nologo=true&seed=${Math.random()}`;
                add(`![gen](${url})`, 'ai');
                return;
            }

            document.getElementById('main').classList.add('thinking');
            try {
                const r = await fetch("/api/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ messages: history, text: val })
                });
                const d = await r.json();
                add(d.content, 'ai');
                history.push({ role: "assistant", content: d.content });
            } catch (e) { add("bridge stall.", "ai"); }
            finally { document.getElementById('main').classList.remove('thinking'); }
        }

        input.addEventListener('keypress', (e) => { if(e.key === 'Enter') send(); });
        window.onload = () => add("dubaaai online.", "ai");
    </script>
</body>
</html>